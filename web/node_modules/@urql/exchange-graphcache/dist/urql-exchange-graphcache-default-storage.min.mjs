import{_ as n}from"./08e6d3e1.min.mjs";function e(n){return new Promise((function(e,t){n.onerror=function(){t(n.error)},n.onsuccess=function(){e(n.result)}}))}function t(n){return new Promise((function(e,t){n.onerror=function(){t(n.error)},n.oncomplete=e}))}function r(r){var o;r||(r={});var u=r.idbName||"graphcache-v4",i="entries",c="metadata",a=Object.create(null),f=Math.floor((new Date).valueOf()/864e5),s=f-(r.maxAge||7),l=indexedDB.open(u,1),d=e(l);function v(n){return n.replace(/:/g,"%3a")}function h(n){return n.replace(/%3a/g,":")}function p(n){for(var e={},t="",r="",o="",u=0,i=0;i<n.length;){for(o="";":"!==(t=n[i++])&&t;)o+=t;u?(e[r]=h(o)||void 0,u=0):(r=h(o),u=1)}return e}return l.onupgradeneeded=function(){l.result.createObjectStore(i),l.result.createObjectStore(c)},{clear:function(){return d.then((function(n){var e=n.transaction([c,i],"readwrite");return e.objectStore(c).clear(),e.objectStore(i).clear(),t(e)}))},readMetadata:function(){return d.then((function(n){return e(n.transaction(c,"readonly").objectStore(c).get(c))}),(function(){return null}))},writeMetadata:function(n){d.then((function(t){return e(t.transaction(c,"readwrite").objectStore(c).put(n,c))}),(function(){}))},writeData:function(t){n(a,t);var r=function(){};return d.then((function(n){return e(n.transaction(i,"readwrite").objectStore(i).put(function(){var n="";for(var e in a){var t=a[e];n+=v(e),n+=":",t&&(n+=v(t)),n+=":"}return n}(),f))})).then(r,r)},readData:function(){var e=[];return d.then((function(r){var o=r.transaction(i,"readwrite"),u=o.objectStore(i);return(u.openKeyCursor||u.openCursor).call(u).onsuccess=function(){if(this.result){var t=this.result.key;if("number"!=typeof t||t<s)u.delete(t);else{var r=u.get(t),o=e.length;e.push(""),r.onsuccess=function(){var u=""+r.result;t===f&&n(a,p(u)),e[o]=u}}this.result.continue()}},t(o)})).then((function(){return p(e.join(""))}),(function(){return a}))},onOnline:function(n){o&&(window.removeEventListener("online",o),o=void 0),window.addEventListener("online",o=function(){n()})}}}export{r as makeDefaultStorage};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.mjs.map
