var e=require("./1cc90026.min.js");function n(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.onsuccess=function(){n(e.result)}}))}function t(e){return new Promise((function(n,t){e.onerror=function(){t(e.error)},e.oncomplete=n}))}exports.makeDefaultStorage=function(r){var o;r||(r={});var u=r.idbName||"graphcache-v4",a="entries",c="metadata",i=Object.create(null),f=Math.floor((new Date).valueOf()/864e5),s=f-(r.maxAge||7),l=indexedDB.open(u,1),d=n(l);function v(e){return e.replace(/:/g,"%3a")}function h(e){return e.replace(/%3a/g,":")}function p(e){for(var n={},t="",r="",o="",u=0,a=0;a<e.length;){for(o="";":"!==(t=e[a++])&&t;)o+=t;u?(n[r]=h(o)||void 0,u=0):(r=h(o),u=1)}return n}return l.onupgradeneeded=function(){l.result.createObjectStore(a),l.result.createObjectStore(c)},{clear:function(){return d.then((function(e){var n=e.transaction([c,a],"readwrite");return n.objectStore(c).clear(),n.objectStore(a).clear(),t(n)}))},readMetadata:function(){return d.then((function(e){return n(e.transaction(c,"readonly").objectStore(c).get(c))}),(function(){return null}))},writeMetadata:function(e){d.then((function(t){return n(t.transaction(c,"readwrite").objectStore(c).put(e,c))}),(function(){}))},writeData:function(t){e._extends(i,t);var r=function(){};return d.then((function(e){return n(e.transaction(a,"readwrite").objectStore(a).put(function(){var e="";for(var n in i){var t=i[n];e+=v(n),e+=":",t&&(e+=v(t)),e+=":"}return e}(),f))})).then(r,r)},readData:function(){var n=[];return d.then((function(r){var o=r.transaction(a,"readwrite"),u=o.objectStore(a);return(u.openKeyCursor||u.openCursor).call(u).onsuccess=function(){if(this.result){var t=this.result.key;if("number"!=typeof t||t<s)u.delete(t);else{var r=u.get(t),o=n.length;n.push(""),r.onsuccess=function(){var u=""+r.result;t===f&&e._extends(i,p(u)),n[o]=u}}this.result.continue()}},t(o)})).then((function(){return p(n.join(""))}),(function(){return i}))},onOnline:function(e){o&&(window.removeEventListener("online",o),o=void 0),window.addEventListener("online",o=function(){e()})}}};
//# sourceMappingURL=urql-exchange-graphcache-default-storage.min.js.map
