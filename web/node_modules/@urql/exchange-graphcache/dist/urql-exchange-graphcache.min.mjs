import{stringifyVariables as e,createRequest as r,formatDocument as t,makeOperation as n}from"@urql/core";import{share as i,merge as a,mergeMap as o,fromArray as u,buffer as s,fromPromise as l,skipUntil as f,map as c,filter as d,empty as p,makeSubject as v}from"wonka";import{_ as y}from"./08e6d3e1.min.mjs";import{Kind as m}from"graphql/language/kinds.mjs";import{valueFromASTUntyped as h}from"graphql/utilities/valueFromASTUntyped.mjs";import{print as g}from"graphql/language/printer.mjs";function k(e){return e.name.value}function _(e){return e.typeCondition.name.value}function O(e){return e.alias?e.alias.value:k(e)}function b(e){return e.selectionSet?e.selectionSet.selections:[]}function w(e){return e.typeCondition?k(e.typeCondition):null}function q(e){return e.kind===m.FIELD}function N(e){return e.kind===m.INLINE_FRAGMENT}function E(e,r){var t={},n=0;if(e.arguments&&e.arguments.length)for(var i=0,a=e.arguments.length;i<a;i++){var o=e.arguments[i],u=h(o.value,r);null!=u&&(t[k(o)]=u,n++)}return n>0?t:null}function K(e,r){if(r&&e.variableDefinitions){for(var t={},n=0,i=e.variableDefinitions.length;n<i;n++){var a=k(e.variableDefinitions[n].variable);t[a]=r[a]}return t}}function x(e,r){var t={};if(!r)return t;if(e.variableDefinitions)for(var n=0,i=e.variableDefinitions.length;n<i;n++){var a=e.variableDefinitions[n],o=k(a.variable);t[o]=void 0===r[o]&&a.defaultValue?h(a.defaultValue,r):r[o]}for(var u in r)u in t||(t[u]=r[u]);return t}function A(e,r,t){if(!e){var n=new Error((r||"Minfied Error #"+t+"\n")+"\nhttps://bit.ly/2XbVrpR#"+t);throw n.name="Graphcache Error",n}}function S(e){for(var r=0;r<e.definitions.length;r++)if(e.definitions[r].kind===m.OPERATION_DEFINITION)return e.definitions[r];A(!1,"",1)}function T(e){for(var r={},t=0;t<e.definitions.length;t++){var n=e.definitions[t];n.kind===m.FRAGMENT_DEFINITION&&(r[k(n)]=n)}return r}function M(e,r){for(var t=0;e.directives&&t<e.directives.length;t++){var n=e.directives[t],i=k(n);if(("include"===i||"skip"===i)&&n.arguments&&n.arguments[0]&&"if"===k(n.arguments[0])){var a=h(n.arguments[0].value,r);return"include"===i?!!a:!a}}return!0}function L(e,r){for(var t=0;e.directives&&t<e.directives.length;t++){var n=e.directives[t];if("defer"===k(n)){for(var i=0;n.arguments&&i<n.arguments.length;i++){var a=n.arguments[t];if("if"===k(a))return!!h(a.value,r)}return!0}}return!1}function F(e,r,t){var n=D(e,r,t);return!!n&&"NON_NULL"!==n.type.kind}function I(e,r,t){var n=D(e,r,t);if(!n)return!1;var i="NON_NULL"===n.type.kind?n.type.ofType:n.type;return"LIST"===i.kind&&"NON_NULL"!==i.ofType.kind}function C(e,r,t){if(!t)return!1;var n=w(r);return!n||t===n||(e.types[n]&&"OBJECT"===e.types[n].kind?n===t:(function(e,r){A(e.types[r]&&("INTERFACE"===e.types[r].kind||"UNION"===e.types[r].kind),"",5)}(e,n),j(e,t),e.isSubType(n,t)))}function D(e,r,t){if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return j(e,r),e.types[r].fields[t]}function j(e,r){A(e.types[r]&&"OBJECT"===e.types[r].kind,"",3)}function P(r,t){return t?r+"("+e(t)+")":r}function R(e,r){return e+"."+r}function J(e){var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}}function Q(e){var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}}function U(){return Object.create(null)}new Set;var B=null,G=null,V=null,z=null,X=null,H=null,W=!1;function Y(){return{optimistic:U(),base:new Map}}function Z(e){var r;if(e){if(B.has(e))return e;r=G.get(e)||y({},e),G.set(e,r)}else r={};return B.add(r),r}function $(e){return!!e&&B.has(e)}function ee(e,r,t,n){B=new Set,G=new Map,V=e,z=r,X=U(),W=!!n,t?n||r.optimisticOrder.length>0?(n||r.commutativeKeys.has(t)?n&&r.commutativeKeys.delete(t):me(r,t),H=t,function(e,r){-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.refLock[r]||(e.refLock[r]=U(),e.links.optimistic[r]=new Map,e.records.optimistic[r]=new Map)}(r,t)):(H=null,ge(r,t)):H=null}function re(){var r=z,t=H;if(W=!1,H=null,t&&r.optimisticOrder.indexOf(t)>-1)for(var n=r.optimisticOrder.length;--n>=0&&r.refLock[r.optimisticOrder[n]]&&r.commutativeKeys.has(r.optimisticOrder[n])&&!r.deferredKeys.has(r.optimisticOrder[n]);)ke(r.optimisticOrder[n]);B=null,G=null,V=null,z=null,X=null,r.defer||(r.defer=!0,Promise.resolve().then((function(){ee("read",r,null),z.gc.forEach((function(e,r,t){if((z.refCount[e]||0)>0)t.delete(e);else{for(var n in z.refLock){var i=z.refLock[n];if((i[e]||0)>0)return;delete i[e]}delete z.refCount[e],t.delete(e),z.records.base.delete(e);var a=z.links.base.get(e);if(a)for(var o in z.links.base.delete(e),a)ue(t,z.refCount,a[o],-1)}})),function(){if(z.storage){W=!0,V="read";var r=U();z.persist.forEach((function(t){var n,i=Q(t),a=i.entityKey,o=i.fieldKey;r[t]=void 0!==(n=pe(a,o))?":"+e(n):void 0!==(n=de(a,o))?e(n):void 0})),W=!1,z.storage.writeData(r),z.persist.clear()}}(),re(),r.defer=!1})))}function te(e,r,t){r&&!t&&e.deferredKeys.delete(r),ee("read",e,r,t),re()}function ne(){return A(null!==X,"",2),X}function ie(e,r,t,n){var i=H?e.optimistic[H]:e.base,a=i.get(r);void 0===a&&i.set(r,a=U()),void 0!==n||H?a[t]=n:delete a[t]}function ae(e,r,t){for(var n,i=!W&&"read"===V&&H&&z.commutativeKeys.has(H),a=0,o=z.optimisticOrder.length;a<o;a++){var u=z.optimisticOrder[a],s=e.optimistic[u];if(i=i&&u!==H,s&&(!i||!z.commutativeKeys.has(u))&&(!W||"write"===V||z.commutativeKeys.has(u))&&void 0!==(n=s.get(r))&&t in n)return n[t]}return void 0!==(n=e.base.get(r))?n[t]:void 0}function oe(e,r,t,n){var i=void 0!==r[t]?r[t]:0,a=r[t]=i+n|0;void 0!==e&&(a<=0?e.add(t):i<=0&&a>0&&e.delete(t))}function ue(e,r,t,n){if("string"==typeof t)oe(e,r,t,n);else if(Array.isArray(t))for(var i=0,a=t.length;i<a;i++)Array.isArray(t[i])?ue(e,r,t[i],n):t[i]&&oe(e,r,t[i],n)}function se(e,r,t){if(void 0!==t)for(var n in t)r.has(n)||(e.push(J(n)),r.add(n))}function le(e,r,t,n){se(e,r,n.base.get(t));for(var i=0,a=z.optimisticOrder.length;i<a;i++){var o=n.optimistic[z.optimisticOrder[i]];void 0!==o&&se(e,r,o.get(t))}}function fe(e,r){"__typename"!==r&&(e!==z.queryRootKey?X[e]=!0:void 0!==r&&(X[R(e,r)]=!0))}function ce(e,r){!W&&z.storage&&z.persist.add(function(e,r){return e.replace(/\./g,"%2e")+"."+r}(e,r))}function de(e,r){return fe(e,r),ae(z.records,e,r)}function pe(e,r){return fe(e,r),ae(z.links,e,r)}function ve(e,r,t){fe(e,r),ce(e,r),ie(z.records,e,r,t)}function ye(e,r,t){var n,i,a,o=z;H?(n=o.refLock[H]||(o.refLock[H]=U()),i=o.links.optimistic[H]):(n=o.refCount,i=o.links.base,a=o.gc);var u=i&&i.get(e),s=u&&u[r];fe(e,r),ce(e,r),ie(o.links,e,r,t),ue(a,n,s,-1),ue(a,n,t,1)}function me(e,r,t){var n=e.optimisticOrder.indexOf(r);-1===n?e.optimisticOrder.unshift(r):e.commutativeKeys.has(r)||(he(e,r),e.optimisticOrder.splice(n,1),e.optimisticOrder.unshift(r)),t?e.deferredKeys.add(r):e.deferredKeys.delete(r),e.commutativeKeys.add(r)}function he(e,r){e.refLock[r]&&(delete e.refLock[r],delete e.records.optimistic[r],delete e.links.optimistic[r],e.deferredKeys.delete(r))}function ge(e,r){var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),he(e,r)}function ke(e){var r=X;X=U();var t=z.links.optimistic[e];t&&t.forEach((function(e,r){for(var t in e)ye(r,t,e[t])}));var n=z.records.optimistic[e];n&&n.forEach((function(e,r){for(var t in e)ve(r,t,e[t])})),X=r,ge(z,e)}function _e(e){var r=z.links,t=z.records,n=[],i=new Set;return fe(e),le(n,i,e,r),le(n,i,e,t),n}var Oe={current:null},be={current:!1};function we(e){return e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0}function qe(e,r,t,n,i,a,o){var u={store:e,variables:r,fragments:t,parent:{__typename:n},parentTypeName:n,parentKey:i,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,optimistic:!!a,__internal:{path:[],errorMap:void 0}};if(o&&o.graphQLErrors)for(var s=0;s<o.graphQLErrors.length;s++){var l=o.graphQLErrors[s];l.path&&l.path.length&&(u.__internal.errorMap||(u.__internal.errorMap=Object.create(null)),u.__internal.errorMap[l.path.join(".")]=l)}return u}function Ne(e,r,t,n,i,a){Oe.current=e,e.parent=r,e.parentTypeName=t,e.parentKey=n,e.parentFieldKey=i,e.fieldName=a,e.error=we(e)}function Ee(e,r,t,n){if(!r)return!1;var i=w(e);return!i||r===i||!b(e).some((function(e){if(!q(e))return!1;var r=P(k(e),E(e,n));return!function(e,r){return void 0!==de(e,r)||void 0!==pe(e,r)}(t,r)}))}function Ke(e,r,t,n){var i,a=!1,o=0;return function(){if(!be.current&&a&&(be.current=a),i){var u=i();if(null!=u)return u;i=void 0,a=!1}for(;o<t.length;){var s=t[o++];if(M(s,n.variables)){if(q(s))return s;var l=N(s)?s:n.fragments[k(s)];if(void 0!==l&&(n.store.schema?C(n.store.schema,l,e):Ee(l,e,r,n.variables)))return a=!!L(s,n.variables),!be.current&&a&&(be.current=a),(i=Ke(e,r,b(l),n))()}}}}function xe(e){return null==e?null:e}function Ae(e,r){if(null==r)return r;if(Array.isArray(r)){for(var t=new Array(r.length),n=0,i=t.length;n<i;n++)t[n]=Ae(e,r[n]);return t}return e.keyOfEntity(r)}function Se(e,r,t,n,i){ee("write",e.data,i||null);var a=Te(e,r,t,n);return re(),a}function Te(e,r,t,n,i){var a=S(r.query),o={data:t,dependencies:ne()},u=e.rootFields[a.operation];return Me(qe(e,x(a,r.variables),T(r.query),u,u,!!i,n),u,b(a),t),o}function Me(e,r,t,n){var i=r===e.store.rootFields.query,a=!i&&!!e.store.rootNames[r],o=a||i?r:n.__typename;if(o){a||i||!r||ve(r,"__typename",o);for(var u,s=Ke(o,r||o,t,e);u=s();){var l=k(u),f=E(u,e.variables),c=P(l,f),d=O(u),p=n[d];if(!("__typename"===l||void 0===p&&be.current)){if(e.__internal.path.push(d),e.optimistic&&a){var v=e.store.optimisticMutations[l];if(!v)continue;Ne(e,n,o,o,c,l),p=n[d]=xe(v(f||{},e.store,e))}if(u.selectionSet)if(r&&!a){var y=R(r,c);ye(r||o,c,Le(e,b(u),xe(p),y))}else Le(e,b(u),xe(p));else r&&!a&&ve(r||o,c,null===p&&we(e)?void 0:p);if(a){var m=e.store.updates[o][l];m&&(Ne(e,n,o,o,R(o,c),l),n[l]=p,m(n,f||{},e.store,e))}e.__internal.path.pop()}}}}function Le(e,r,t,n){if(Array.isArray(t)){for(var i=new Array(t.length),a=0,o=t.length;a<o;a++){e.__internal.path.push(a);var u=n?R(n,""+a):void 0,s=Le(e,r,t[a],u);i[a]=s,e.__internal.path.pop()}return i}if(null===t)return we(e)?void 0:null;var l=e.store.keyOfEntity(t)||n;return Me(e,l,r,t),l||null}function Fe(e){var r,t;this.keyOfField=P,this.resolveFieldByKey=this.resolve,e||(e={}),this.resolvers=e.resolvers||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{};var n,i="Query",a="Mutation",o="Subscription";if(e.schema){var u=function(e){var r=e.__schema,t={};function n(e){for(var r={},t=0;t<e.length;t++)r[e[t].name]=e[t];return r}function i(e){switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:n(e.interfaces||[]),fields:n(e.fields.map((function(e){return{name:e.name,type:e.type,args:n(e.args)}})))};case"UNION":return{name:e.name,kind:e.kind,types:n(e.possibleTypes||[])}}}var a={query:r.queryType?r.queryType.name:null,mutation:r.mutationType?r.mutationType.name:null,subscription:r.subscriptionType?r.subscriptionType.name:null,types:void 0,isSubType:function(e,r){var n=t[e],i=t[r];return!!(n&&i&&("UNION"===n.kind?n.types[r]:"OBJECT"!==n.kind&&"OBJECT"===i.kind?i.interfaces[e]:e===r))}};if(r.types){a.types=t;for(var o=0;o<r.types.length;o++){var u=r.types[o];if(u&&u.name){var s=i(u);s&&(t[u.name]=s)}}}return a}(e.schema);i=u.query||i,a=u.mutation||a,o=u.subscription||o,u.types&&(this.schema=u)}this.updates=((r={})[a]=e.updates&&e.updates.Mutation||{},r[o]=e.updates&&e.updates.Subscription||{},r),this.rootFields={query:i,mutation:a,subscription:o},this.rootNames=((t={})[i]="query",t[a]="mutation",t[o]="subscription",t),this.data=(n=i,{defer:!1,gc:new Set,persist:new Set,queryRootKey:n,refCount:U(),refLock:U(),links:Y(),records:Y(),deferredKeys:new Set,commutativeKeys:new Set,optimisticOrder:[],storage:null})}function Ie(e,r,t,n,i){ee("read",e.data,i);var a=Ce(e,r,t,n);return re(),a}function Ce(e,r,t,n){var i=S(r.query),a=e.rootFields[i.operation],o=b(i),u=qe(e,x(i,r.variables),T(r.query),a,a,!1,n);t||(t=Z());var s=a!==u.store.rootFields.query?De(u,a,o,t):Pe(u,a,o,t);return{dependencies:ne(),partial:u.partial||!s,data:s||null}}function De(e,r,t,n){if("string"!=typeof(e.store.rootNames[r]?r:n.__typename))return n;for(var i,a=Ke(r,r,t,e),o=!1,u=Z(n);i=a();){var s,l=O(i),f=n[l];e.__internal.path.push(l),s=i.selectionSet&&null!==f?je(e,b(i),xe(f)):f,o=o||s!==f,void 0!==s&&(u[l]=s),e.__internal.path.pop()}return o?u:n}function je(e,r,t){if(Array.isArray(t)){for(var n=new Array(t.length),i=!1,a=0,o=t.length;a<o;a++)e.__internal.path.push(a),n[a]=je(e,r,t[a]),i=i||n[a]!==t[a],e.__internal.path.pop();return i?n:t}if(null===t)return null;var u=e.store.keyOfEntity(t);return null!==u?Pe(e,u,r,t)||null:De(e,t.__typename,r,t)}function Pe(e,r,t,n,i){var a=e.store,o=r===a.rootFields.query,u=i&&a.keyOfEntity(i)||r,s=o?r:de(u,"__typename")||i&&i.__typename;if("string"==typeof s&&(!i||s===i.__typename)){for(var l,f=Ke(s,u,t,e),c=!1,d=!1,p=s!==n.__typename,v=Z(n);void 0!==(l=f());){var y=k(l),m=E(l,e.variables),h=O(l),g=P(y,m),_=R(u,g),w=de(u,g),q=i?i[y]:void 0,N=a.resolvers[s];e.__internal.path.push(h);var K=void 0;if("__typename"===y)K=s;else if(void 0!==q&&void 0===l.selectionSet)K=q;else if("read"===(A(null!==V,"",2),V)&&N&&"function"==typeof N[y]){if(Ne(e,v,s,u,_,y),void 0!==w&&(v[h]=w),K=N[y](v,m||{},a,e),l.selectionSet&&(K=Re(e,s,y,_,b(l),void 0!==v[h]?v[h]:n[h],K,$(n))),a.schema&&null===K&&!F(a.schema,s,y))return}else if(l.selectionSet)if(void 0!==q)K=Re(e,s,y,_,b(l),void 0!==v[h]?v[h]:n[h],q,$(n));else{var x=pe(u,g);void 0!==x?K=Je(e,x,s,y,b(l),void 0!==v[h]?v[h]:n[h],$(n)):"object"==typeof w&&null!==w&&(K=w)}else K=w;if(void 0===K&&be.current)c=!0;else if(void 0===K&&(a.schema&&F(a.schema,s,y)||we(e)))d=!0,K=null;else{if(void 0===K)return void e.__internal.path.pop();c=c||"__typename"!==y}e.__internal.path.pop(),p=p||K!==n[h],void 0!==K&&(v[h]=K)}return e.partial=e.partial||d,o&&d&&!c?void 0:p?v:n}}function Re(e,r,t,n,i,a,o,u){if(Array.isArray(o)){for(var s=e.store,l=!!s.schema&&I(s.schema,r,t),f=new Array(o.length),c=!Array.isArray(a)||o.length!==a.length,d=0,p=o.length;d<p;d++){e.__internal.path.push(d);var v=Re(e,r,t,R(n,""+d),i,null!=a?a[d]:void 0,o[d],u);if(e.__internal.path.pop(),void 0===v&&!l)return;e.partial=e.partial||void 0===v&&l,f[d]=null!=v?v:null,c=c||f[d]!==a[d]}return c?f:a}if(null==o)return o;if(u&&null===a)return null;if("string"==typeof(m=o)||"object"==typeof m&&"string"==typeof m.__typename){var y=a||Z();return"string"==typeof o?Pe(e,o,i,y):Pe(e,n,i,y,o)}var m}function Je(e,r,t,n,i,a,o){if(Array.isArray(r)){for(var u=e.store,s=!!u.schema&&I(u.schema,t,n),l=new Array(r.length),f=!Array.isArray(a)||l.length!==a.length,c=0,d=r.length;c<d;c++){e.__internal.path.push(c);var p=Je(e,r[c],t,n,i,null!=a?a[c]:void 0,o);if(e.__internal.path.pop(),void 0===p&&!s)return;e.partial=e.partial||void 0===p&&s,l[c]=p||null,f=f||l[c]!==a[c]}return f?l:a}return null===r||null===a&&o?null:Pe(e,r,i,a||Z())}function Qe(e,r){return n(e.kind,e,y({},e.context,{meta:y({},e.context.meta,{cacheOutcome:r})}))}function Ue(e,r){return n(e.kind,e,y({},e.context,{requestPolicy:r}))}function Be(e){return function(r){var v,y=r.forward,m=r.client,h=new Fe(e);e&&e.storage&&(v=e.storage.readData().then((function(r){!function(e,r,t){for(var n in ee("write",e,null),t){var i=t[n];if(void 0!==i){var a=Q(n),o=a.entityKey,u=a.fieldKey;":"===i[0]?ye(o,u,JSON.parse(i.slice(1))):ve(o,u,JSON.parse(i))}}re(),e.storage=r}(h.data,e.storage,r)})));var g=new Map,k=[],_=new Map,O=new Map,b=U(),w=new Set,q=U();function N(e){for(var r in e)if(b[r])return!0;return!1}function E(e,r){if(r)for(var t in r){var n=q[t];if(n){q[t]=[];for(var i=0,a=n.length;i<a;i++)e.add(n[i])}}}function x(e,r){r.forEach((function(r){if(r!==e.key){var t=_.get(r);if(t){_.delete(r);var n="cache-first";w.has(r)&&(w.delete(r),n="cache-and-network"),m.reexecuteOperation(Ue(t,n))}}}))}function A(e){if("query"===e.kind)me(h.data,e.key);else if("teardown"===e.kind)_.delete(e.key),O.delete(e.key),te(h.data,e.key);else if("mutation"===e.kind&&"network-only"!==e.context.requestPolicy){var r=function(e,r,t){ee("write",e.data,t,!0);var n=Te(e,r,{},void 0,!0);return re(),n}(h,e,e.key).dependencies;if(!function(e){for(var r in e)return!1;return!0}(r)){for(var i in r)b[i]=!0;g.set(e.key,r);var a=new Set;E(a,r),x(e,a)}}return n(e.kind,{key:e.key,query:t(e.query),variables:e.variables?K(S(e.query),e.variables):e.variables},e.context)}function T(e,r){for(var t in r)(q[t]||(q[t]=[])).push(e.key),_.set(e.key,e)}function M(e){var r=Ie(h,e,O.get(e.key)),t=r.data?r.partial?"partial":"hit":"miss";return O.set(e.key,r.data),T(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies}}function L(e,r){var t,n=e.operation,i=e.error,a=e.extensions,o=n.key;"mutation"===n.kind&&(E(r,g.get(o)),g.delete(o)),me(h.data,n.key,e.hasNext);var u=e.data;if(u){E(r,Se(h,n,u,e.error,o).dependencies);var s=Ie(h,n,"query"===n.kind&&O.get(n.key)||u,e.error,o);u=s.data,"query"===n.kind&&(E(r,t=s.dependencies),O.set(n.key,e.data))}else te(h.data,n.key);return t&&T(e.operation,t),{data:u,error:i,extensions:a,operation:n}}return function(e){var r=i(e),t=v?i(a([o(u)(s(l(v))(r)),f(l(v))(r)])):r,n=i(c(M)(d((function(e){return"query"===e.kind&&"network-only"!==e.context.requestPolicy}))(t))),_=d((function(e){return"query"!==e.kind||"network-only"===e.context.requestPolicy}))(t),O=c((function(e){return Qe(e.operation,"miss")}))(d((function(e){return"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!N(e.dependencies)}))(n)),q=c((function(e){var r=e.operation,t=e.outcome,n=e.dependencies,i={operation:Qe(r,t),data:e.data,error:e.error,extensions:e.extensions};return("cache-and-network"===r.context.requestPolicy||"cache-first"===r.context.requestPolicy&&"partial"===t)&&(i.stale=!0,N(n)?"cache-and-network"===r.context.requestPolicy&&w.add(r.key):m.reexecuteOperation(Ue(r,"network-only"))),i}))(d((function(e){return"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy}))(n)),E=i(y(c(A)(a([_,O])))),K=c((function(e){var r=new Set,t=L(e,r);return x(e.operation,r),t}))(d((function(e){return!g.has(e.operation.key)}))(E)),S=o((function(e){if(k.push(e)<g.size)return p;for(var r=0;r<k.length;r++)me(h.data,k[r].operation.key);for(var t in b)delete b[t];for(var n,i=[],a=new Set;n=k.shift();)i.push(L(n,a));return x(e.operation,a),u(i)}))(d((function(e){return g.has(e.operation.key)}))(E));return a([K,S,q])}}}function Ge(e){return e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message))}function Ve(e){return function(t){var o=e.storage;if(o&&o.onOnline&&o.readMetadata&&o.writeMetadata){var u=t.forward,s=t.client,l=t.dispatchDebug,f=v(),c=f.source,p=f.next,y=e.optimistic||{},m=[],h=function(){for(var e=[],r=0;r<m.length;r++){var t=m[r];"mutation"===t.kind&&e.push({query:g(t.query),variables:t.variables})}o.writeMetadata(e)},_=!1,O=function(){if(!_){_=!0;for(var e=0;e<m.length;e++){var r=m[e];"mutation"===r.kind&&p(n("teardown",r))}for(var t=0;t<m.length;t++)s.reexecuteOperation(m[t]);m.length=0,_=!1,h()}};o.onOnline(O),o.readMetadata().then((function(e){if(e){for(var t=0;t<e.length;t++)m.push(s.createRequestOperation("mutation",r(e[t].query,e[t].variables)));O()}}));var w=Be(e)({client:s,dispatchDebug:l,forward:function(e){return d((function(e){return"mutation"!==e.operation.kind||!Ge(e.error)||!function(e,r){for(var t,n=r.variables||U(),i=T(r.query),a=[].concat(b(S(r.query)));t=a.pop();)if(M(t,n))if(q(t)){if(e[k(t)])return!0}else{var o=N(t)?t:i[k(t)];o&&a.push.apply(a,b(o))}return!1}(y,e.operation)||(m.push(e.operation),h(),!1)}))(u(e))}});return function(e){var r=i(e),t=a([c,r]);return d((function(e){return"query"!==e.operation.kind||!Ge(e.error)||(p(Ue(e.operation,"cache-only")),m.push(e.operation),!1)}))(w(t))}}return Be(e)(t)}}Fe.prototype.keyOfEntity=function(e){return Oe.current&&e===Oe.current.parent?Oe.current.parentKey:null==e||"string"==typeof e?e||null:e.__typename?this.rootNames[e.__typename]?e.__typename:(this.keys[e.__typename]?r=this.keys[e.__typename](e):null!=e.id?r=""+e.id:null!=e._id&&(r=""+e._id),r?e.__typename+":"+r:null):null;var r},Fe.prototype.resolve=function(e,r,t){var n=P(r,t),i=this.keyOfEntity(e);if(!i)return null;var a=de(i,n);return void 0!==a?a:pe(i,n)||null},Fe.prototype.invalidate=function(e,r,t){var n=this.keyOfEntity(e);A(n,"",19),function(e,r,t){for(var n=r?[{fieldKey:P(r,t)}]:_e(e),i=0,a=n.length;i<a;i++){var o=n[i].fieldKey;void 0!==pe(e,o)?ye(e,o,void 0):ve(e,o,void 0)}}(n,r,t)},Fe.prototype.inspectFields=function(e){var r=this.keyOfEntity(e);return r?_e(r):[]},Fe.prototype.updateQuery=function(e,n){var i=r(e.query,e.variables);i.query=t(i.query);var a=n(this.readQuery(i));null!==a&&Te(this,i,a)},Fe.prototype.readQuery=function(e){var n=r(e.query,e.variables);return n.query=t(n.query),Ce(this,n).data},Fe.prototype.readFragment=function(e,r,n){return function(e,r,t,n){var i=T(r),a=i[Object.keys(i)[0]];if(!a)return null;var o=_(a);"string"==typeof t||t.__typename||(t.__typename=o);var u=e.keyOfEntity(t);return u&&Pe(qe(e,n||{},i,o,u),u,b(a),Z())||null}(this,t(e),r,n)},Fe.prototype.writeFragment=function(e,r,n){!function(e,r,t,n){var i=T(r),a=i[Object.keys(i)[0]];if(a){var o=_(a),u=y({},{__typename:o},t),s=e.keyOfEntity(u);s&&Me(qe(e,n||{},i,o,s,void 0),s,b(a),u)}}(this,t(e),r,n)},Fe.prototype.link=function(e,r,t,n){var i=void 0!==n?t:null,a=void 0!==n?n:t,o=Ae(this,e);"string"==typeof o&&ye(o,P(r,i),Ae(this,a))};export{Fe as Store,Be as cacheExchange,Ve as offlineExchange,Ie as query,Se as write};
//# sourceMappingURL=urql-exchange-graphcache.min.mjs.map
